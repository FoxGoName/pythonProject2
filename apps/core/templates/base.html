{% load static %}
{% load i18n %}
<!-DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>{% block title %}{% endblock %}E-shop</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
		<link rel="stylesheet" href="{% static 'main.css' %}">
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-pageloader@0.9.0/css/bulma-pageloader.min.css">
	</head>

	<body>
		<div>
			<button id="small-font">小</button>
			<button id="medium-font">中</button>
			<button id="large-font">大</button>
		</div>
		<div id="content" style="font-size: 16px;">
		<nav class="navbar is-dark" id="navbarapp">
			<div class="navbar-brand">
				<a class="navbar-item" href="{% url 'frontpage' %}">{% trans 'E-shop' %}</a>

				<a @click="toggleMenu()" role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="main-navbar">
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
				</a>
			</div>

			<div id="main-navbar" class="navbar-menu" :class="{ 'is-active': menuClass }">
				<div class="navbar-start">
					<div class="navbar-item is-expanded" style="margin-top: 0.8rem;">
						<form method="get" action="{% url 'search' %}" class="is-flex is-justify-content-center">
							<div class="field has-addons is-centered">
								<div class="control">
									<input type="text" class="input" placeholder="Search..." name="query">
								</div>
								<div class="control">
									<button class="button is-success">{% trans 'Search' %}</button>
								</div>
							</div>
						</form>
					</div>
				</div>
				
				<div class="navbar-end">
					{% comment %} {% for category in menu_categories %}
						{% if not category.children.all %}
                        	<a href="{% url 'category_detail' category.slug %}" class="navbar-item">{{ category.title }}</a>
						{% else %}
							<div class="navbar-item has-dropdown is-hoverable">
								<a href="{% url 'category_detail' category.slug %}" class="navbar-link">{{ category.title }}</a>
							
								<div class="navbar-dropdown">
									{% for subcategory in category.children.all %}
										<a href="{% url 'category_detail' subcategory.slug %}" class="navbar-item">{{ subcategory.title }}</a>
									{% endfor %}
								</div>
							</div>
						{% endif %}		
					{% endfor %} {% endcomment %}
					<div class="navbar-item has-dropdown is-hoverable">
						<a href="#" class="navbar-link">{% trans 'Categories' %}</a>
						<div class="navbar-dropdown">
						  <div class="category-table">
							{% for category in menu_categories %}
							  <a href="{% url 'category_detail' category.slug %}" class="navbar-item">{{ category.title }}</a>
							{% endfor %}
						  </div>
						</div>
					</div>
					
					<div class="navbar-item">
						{% if request.user.is_authenticated %}
							<a href="{% url 'cart' %}" class="button is-primary">{% trans 'Cart' %} ([[ numItems ]])</a>
						{% else %}
							<a href="{% url 'login' %}" class="button is-primary">{% trans 'Cart' %} ([[ numItems ]])</a>
						{% endif %}
					</div>

					{% if request.user.is_authenticated %}
						<div class="navbar-item">
							<a href="{% url 'myaccount' %}" class="button is-light">{% trans 'My account' %}</a>
						</div>
					{% else %}
						<div class="navbar-item">
							<div class="buttons">
								<a href="{% url 'signup' %}" class="button is-primary"><strong>{% trans 'Sign up' %}</strong></a>
								<a href="{% url 'login' %}" class="button is-light">{% trans 'Log in' %}</a>
							</div>
						</div>
					{% endif %}
					
					{% comment %} 第一种语言下拉框 {% endcomment %}
					{% comment %} <div class="navbar-item">
						<div class="dropdown-trigger">
							<form class="button" action="{% url 'set_language' %}" method="post">
								{% csrf_token %}
				
								
									<select name="language" onchange="this.form.submit()">
										{% get_current_language as LANGUAGE_CODE %}
										{% get_available_languages as LANGUAGES %}
										{% get_language_info_list for LANGUAGES as languages %}
										{% for language in languages %}
				
											<option value="{{ language.code }}"{% if language.code == LANGUAGE_CODE %} selected {% endif %}>
												{{ language.name_local }}
											</option>
										{% endfor %}
									</select>
								
							</form>
						</div>
					</div> {% endcomment %}

					{% comment %} 第二种语言下拉框 {% endcomment %}
					<div class="navbar-item has-dropdown is-hoverable">
						<a href="#" class="navbar-link">Language</a>
						<div class="navbar-dropdown">
						  <form class="navbar-item" action="{% url 'set_language' %}" method="post">
							{% csrf_token %}
							<div class="select">
							  <select name="language" onchange="this.form.submit()">
								{% get_current_language as LANGUAGE_CODE %}
								{% get_available_languages as LANGUAGES %}
								{% get_language_info_list for LANGUAGES as languages %}
								{% for language in languages %}
								  <option value="{{ language.code }}" {% if language.code == LANGUAGE_CODE %} selected {% endif %}>
									{{ language.name_local }}
								  </option>
								{% endfor %}
							  </select>
							</div>
						  </form>
						</div>
					  </div>
						
					
				</div>
			</div>
		</nav>
		{% comment %} <nav class="navbar navbar-expand-md fixed-top navbar-light box-shadow bg-white">
			<div class="container">
				<form class="form-inline ml-auto" action="{% url 'set_language' %}" method="post">
					{% csrf_token %}
		
					<div class="input-group">
						<select name="language" class="form-control">
							{% get_current_language as LANGUAGE_CODE %}
							{% get_available_languages as LANGUAGES %}
							{% get_language_info_list for LANGUAGES as languages %}
							{% for language in languages %}
		
								<option value="{{ language.code }}"{% if language.code == LANGUAGE_CODE %} selected {% endif %}>
									{{ language.name_local }}
								</option>
							{% endfor %}
						</select>
						<div class="input-group-append">
							<button type="submit" class="btn btn-inline btn-sm bg-success">
								{% trans "Select" %}
							</button>
						</div>
					</div>
				</form>
			</div>
		</nav> {% endcomment %}

		<section class="section">
			{% block content %}
            {% endblock %}
		</section>

		{% if products.has_other_pages %}
    	<nav class="pagination is-centered" role="navigation" aria-label="pagination">
        	{% if products.has_previous %}
            	<a href="?page=1" class="pagination-previous">{% trans 'First' %}</a>
            	<a href="?page={{ products.previous_page_number }}" class="pagination-previous">{% trans 'Previous' %}</a>
        	{% else %}
            	<a class="pagination-previous" disabled>{% trans 'First' %}</a>
            	<a class="pagination-previous" disabled>{% trans 'Previous' %}</a>
        	{% endif %}

        	<ul class="pagination-list">
            	{% for num in products.paginator.page_range %}
                	{% if num == products.number %}
                    	<li>
                        	<a href="?page={{ num }}" class="pagination-link is-current" aria-label="Page {{ num }}" aria-current="page">{{ num }}</a>
                    	</li>
                	{% else %}
                    	<li>
                        	<a href="?page={{ num }}" class="pagination-link" aria-label="Goto page {{ num }}">{{ num }}</a>
                    	</li>
                	{% endif %}
            	{% endfor %}
        	</ul>

        	{% if products.has_next %}
            	<a href="?page={{ products.next_page_number }}" class="pagination-next">{% trans 'Next' %}</a>
            	<a href="?page={{ products.paginator.num_pages }}" class="pagination-next">{% trans 'Last' %}</a>
        	{% else %}
            	<a class="pagination-next" disabled>{% trans 'Next' %}</a>
            	<a class="pagination-next" disabled>{% trans 'Last' %}</a>
     		{% endif %}
    	</nav>
		{% endif %}

		{% comment %} {% include 'parts/newsletter.html' %} {% endcomment %}


		<footer class="footer">
			<div class="columns">
				<div class="column is-4">
					<h2 class="subtitle">{% trans 'E-shop' %}</h2>
				</div>

				<div class="column is-8">
					<a href="{% url 'contact' %}" class="navbar-item">{% trans 'Contact' %}</a>
					<a href="{% url 'about' %}" class="navbar-item">{% trans 'About' %}</a>
				</div>
			</div>
		</footer>

		<script src="https://unpkg.com/vuex@3.5.1/dist/vuex.js"></script>
		<script>
			var store = new Vuex.Store({
				state: {
					numItems: {{ cart.get_total_length }},
					totalCost: {{ cart.get_total_cost }}
				},
				mutations: {
					increment(state, quantity) {
						state.numItems += quantity;
					},
					changeTotalCost(state, newCost) {
						state.totalCost += newCost
					}
				}
			});

			var navbarapp = new Vue({
				el: '#navbarapp',
				delimiters: ['[[', ']]'],
				store: store,
				data () {
					return {
						menuClass: false
					}
				},
				computed: {
					numItems: function() {
						return store.state.numItems
					}
				},
				methods: {
					toggleMenu() {
						console.log('toggleMenu');

						this.menuClass = !this.menuClass;
					}
				}
			});
		</script>

<!-- <script>
    document.getElementById('small-font').addEventListener('click', function() {
        document.getElementById('content').style.fontSize = '10px';
    });
    
    document.getElementById('medium-font').addEventListener('click', function() {
        document.getElementById('content').style.fontSize = '16px';
    });
    
    document.getElementById('large-font').addEventListener('click', function() {
        document.getElementById('content').style.fontSize = '22px';
    });
</script> -->
<script>
    // 检查本地存储中是否有字体大小设置
    var fontSize = localStorage.getItem('fontSize');
    if (fontSize) {
        document.getElementById('content').style.fontSize = fontSize;
    }

    document.getElementById('small-font').addEventListener('click', function() {
        document.getElementById('content').style.fontSize = '10px';
        // 将选择的字体大小保存到本地存储
        localStorage.setItem('fontSize', '10px');
    });

    document.getElementById('medium-font').addEventListener('click', function() {
        document.getElementById('content').style.fontSize = '16px';
        localStorage.setItem('fontSize', '16px');
    });

    document.getElementById('large-font').addEventListener('click', function() {
        document.getElementById('content').style.fontSize = '22px';
        localStorage.setItem('fontSize', '22px');
    });
</script>

		{% block scripts %}
		{% endblock %}
	</div>
	</body>
</html>